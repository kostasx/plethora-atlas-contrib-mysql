// Generated by CoffeeScript 1.12.4
var colors, initCommands;

colors = require('colors');

initCommands = function(program) {
  return program.command('mysql').description('MySQL Database related utilities').option('--create-db <dbname>', 'Create a MySQL Database').option('--drop-db <dbname>', 'Drop a MySQL Database.').option('--rm-db <dbname>', 'Alias for --drop-db').option('--del-db <dbname>', 'Alias for --drop-db').option('--show-db', 'Show current MySQL Databases').option('--dump-db <dbname>', 'Dump selected MySQL Database').action(function(options) {
    return Helpers.configurator().then(function(res) {
      var database;
      database = require('./mysql');
      database.init({
        host: config.mysql.host,
        user: config.mysql.user,
        password: config.mysql.password
      });
      if (options.createDb) {
        console.log("Creating Database " + options.createDb + "...");
        database.databaseExists({
          dbname: options.createDb
        }).then(database.createDatabase.bind(null, {
          dbname: options.createDb
        })).then(function(res) {
          return console.log(res);
        });
      }
      if (options.dropDb || options.rmDb || options.delDb) {
        console.log("Removing Database " + options.dropDb + "...");
        database.dropDatabase({
          dbname: options.dropDb
        }).then(function(res) {
          return console.log(res);
        });
      }
      if (options.showDb) {
        console.log("Getting Databases...");
        database.getDatabases().then(function(res) {
          return console.log(res);
        })["catch"](function(e) {
          return console.log(e);
        });
      }
      if (options.dumpDb) {
        console.log("Dumping Database " + options.dumpDb + "...");
        return database.mySqlDump({
          dbname: options.dumpDb,
          mysqldump_bin: config.database.mysqldump_bin,
          write: true
        }).then(function(res) {
          return console.log(res);
        })["catch"](function(e) {
          return console.log(e);
        });
      }
    })["catch"](console.log);
  });
};

module.exports = initCommands;
